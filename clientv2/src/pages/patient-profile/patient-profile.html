<!-- start side bar -->
<app-side-bar [isOpen] = "isOpen"></app-side-bar>
<!-- end sidebar -->

<!-- start min top nav -->
<app-nav-bar (toggle)="isOpen = !isOpen"></app-nav-bar>
<!-- end min top nav -->

<!-- start main -->
<main [ngClass]="{'md:ml-64 md:w-[calc(100%-256px)]': isOpen, 'md:ml-0': !isOpen}" class="bg-gray-100 duration-500 w-full h-svh pt-16 overflow-y-scroll">

    <section >
        <!-- information personnel -->
         @if (patient) {
             <div class="m-8 bg-white rounded-lg shadow-md overflow-hidden p-6">
                 <div class="flex items-center space-x-4 mb-6">
                     <div class="h-16 w-16 bg-blue-100 rounded-full flex items-center justify-center">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                     </svg>
                     </div>
                     <div>
                     <h2 class="text-2xl font-bold text-gray-800">{{ patient.nom }} {{ patient.prenom }}</h2>
                     <p class="text-gray-600">{{ patient.sexe }}, {{ patient.dateNaissance }}</p>
                     </div>
                 </div>

                 <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                     <div class="bg-gray-50 p-4 rounded-lg">
                     <h3 class="text-sm font-medium text-gray-500 mb-1">CIN</h3>
                     <p class="text-gray-900">{{ patient.cin }}</p>
                     </div>

                     <div class="bg-gray-50 p-4 rounded-lg">
                     <h3 class="text-sm font-medium text-gray-500 mb-1">Téléphone</h3>
                     <p class="text-gray-900">{{ patient.telephone }}</p>
                     </div>

                     <div class="bg-gray-50 p-4 rounded-lg col-span-1 md:col-span-2">
                     <h3 class="text-sm font-medium text-gray-500 mb-1">Email</h3>
                     <p class="text-gray-900">{{ patient.email }}</p>
                     </div>

                     <div class="bg-gray-50 p-4 rounded-lg col-span-1 md:col-span-2">
                     <h3 class="text-sm font-medium text-gray-500 mb-1">Adresse</h3>
                     <p class="text-gray-900">{{ patient.adresse }}</p>
                     </div>
                 </div>
             </div>
         }


        <!-- les documents medicales -->
         @if (documents) {
             <div class="m-8 bg-white rounded-lg shadow-md overflow-hidden p-6">
                <h3 class="mb-4 font-bold text-xl">les documents medicales</h3>
                <div class="flex items-center space-x-4 mb-6 ">
                    <p-table
                        [paginator]="true"
                        [rows]="5"
                        [value]="documents"
                        stripedRows
                        showGridlines
                        [tableStyle]="{'min-width': '50rem'}"
                        [tableStyle]="{'min-height': '20rem'}">
                        <ng-template #caption>
                            <p-button (onClick)="showUploadDialogue()" label="Ajouter" severity="info" [raised]="true" icon="pi pi-upload" iconPos="right" />
                        </ng-template>
                        <ng-template #header>
                            <tr>
                                <th>Nom de document</th>
                                <th>catégorie</th>
                                <th>extension</th>
                                <th>Date de téléchargement</th>
                            </tr>
                            <tr>
                                <th class="bg-slate-100"></th>
                                <th>
                                    <p-columnFilter field="typeDocument" matchMode="in" [showMenu]="false">
                                        <ng-template #filter let-value let-filter="filterCallback">
                                            <p-multiselect [options]="categories" placeholder="Any" [filter]="false" [showToggleAll]="false" (onChange)="filter($event.value)" style="min-width: 14rem" [panelStyle]="{ minWidth: '16rem' }">
                                            </p-multiselect>
                                        </ng-template>
                                    </p-columnFilter>
                                </th>
                                <th class="bg-slate-100"></th>
                                <th class="bg-slate-100"></th>
                            </tr>
                        </ng-template>
                        <ng-template #body let-document>
                            <tr class="bg-white border-b">
                                <td class="px-6 py-4">{{document.nom}}</td>
                                <td class="px-6 py-4">{{document.typeDocument}}</td>
                                <td class="px-6 py-4">{{document.extension}}</td>
                                <td class="px-6 py-4">{{document.uploadDate}}</td>
                        </tr>
                    </ng-template>
                    </p-table>
                </div>
             </div>
         }

    </section>

    <p-dialog header="télécharger un nouveau document" [modal]="true" [(visible)]="upload_visibility" [style]="{ width: '30rem' }">
        <form [formGroup]="fg" (ngSubmit)="upload()"  class="w-full p-4 border border-gray-300 bg-white">
            <div class="grid grid-cols-2 gap-5 text-black">
              <!-- categorie -->
                <div>
                    <label class="block mb-2 text-sm font-medium" for="">catégorie</label>
                    <select formControlName="typeDocument" name="typeDocument" class="w-full  mb-3 bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5">
                        <option value="RADIO">radio</option>
                        <option value="COMPTE_RENDU">compte rendu</option>
                        <option value="ANALYSE">analyse</option>
                    </select>
                </div>

              <!-- fichier -->
               <div class="col-start-1 col-end-3">
                   <label for="file-input" class="sr-only">Choisir un fichier</label>
                   <input type="file" (change)="onFileSelected($event)" name="file-input" id="file-input" class="block w-full border border-gray-200 shadow-sm rounded-lg text-sm focus:z-10 focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none file:bg-gray-50 file:border-0 file:me-4 file:py-3 file:px-4">
               </div>

            </div>
            <button type="submit" class="w-full mt-5 rounded-md bg-blue-600 text-center py-3 text-white">
              télécharger
            </button>
          </form>
    </p-dialog>

    <p-toast />
    <p-confirmdialog />
</main>
<!-- end main -->
