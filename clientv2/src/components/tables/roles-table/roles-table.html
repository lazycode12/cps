<div class="m-4">
  <p-button (onClick)="showCreateDialog()" label="créer role"  icon="pi pi-plus" iconPos="right" [raised]="true"  severity="info" class="mx-3"/>
</div>
<p-table
    [paginator]="true"
    [rows]="5"
    [value]="roles"
    stripedRows
    showGridlines
    [tableStyle]="{'min-width': '50rem'}">
    <ng-template #header>
        <tr>
            <th>nom</th>
            <th>description</th>
            <th>actions</th>
        </tr>
    </ng-template>
    <ng-template #body let-role>
        <tr>
            <td>{{role.nom}}</td>
            <td>{{role.description}}</td>
            <td>
                <p-button (onClick)="showEditDialog(role)"  icon="pi pi-pencil" [rounded]="true" [raised]="true"  severity="info" class="mx-3"/>
                <p-button (onClick)="deleteRole(role.id)"  icon="pi pi-trash" [rounded]="true" [raised]="true"  severity="danger"/>
            </td>
        </tr>
    </ng-template>
</p-table>

  <!-- role create form popup -->
  <p-dialog header="créer ce compte" [modal]="true" [(visible)]="visible_create" [style]="{ width: '30rem' }">
      <form [formGroup]="fg" (ngSubmit)="create()"  class="w-full p-4 border border-gray-300 bg-white" action="#" method="post">
          <div class="grid grid-cols-2 gap-5 text-black">

            <!-- nom -->
            <div>
              <label class="block mb-2 text-sm font-medium" for="">nom</label>
              <input type="text" formControlName="nom" name="nom" class="block w-full p-2.5 text-sm bg-white border-gray-300 border rounded-lg focus:ring-blue-500 focus:border-blue-500"/>
            </div>

            <!-- description -->
            <div>
              <label class="block mb-2 text-sm font-medium" for="">description</label>
              <textarea formControlName="description" name="description" class="block w-full p-2.5 text-sm bg-white border-gray-300 border rounded-lg focus:ring-blue-500 focus:border-blue-500" ></textarea>
            </div>

            <!-- Permissions Section -->
            <div class="mt-6 col-span-2">
              <label class="block mb-3 text-sm font-medium">Permissions:</label>
              <div class="grid grid-cols-2 gap-3 max-h-60 overflow-y-auto p-2 border border-gray-200 rounded-lg">
                @if (permissions) {
                  @for (permission of permissions; track $index) {

                    <div class="flex items-start">
                      <input
                        #checkboxInput
                        type="checkbox"
                        [id]="'perm_' + permission.id"
                        [checked]="isPermissionSelected(permission.id)"
                        (change)="onPermissionChange(permission.id, checkboxInput.checked)"
                        class="mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                      >
                      <label [for]="'perm_' + permission.id" class="ml-2 text-sm cursor-pointer">
                        <span class="font-medium">{{ permission.nom }}</span>
                      </label>
                    </div>
                  }
                }
              </div>
            </div>

          </div>
          <button type="submit" class="w-full mt-5 rounded-md bg-blue-600 text-center py-3 text-white">
            créer
          </button>
        </form>
  </p-dialog>
  <!-- end compte create form popup -->

  <!-- role edit form popup -->
  <p-dialog header="modifier ce compte" [modal]="true" [(visible)]="visible_edit" [style]="{ width: '30rem' }">
      <form [formGroup]="fg" (ngSubmit)="edit($event)"  class="w-full p-4 border border-gray-300 bg-white" action="#" method="post">
          <div class="grid grid-cols-2 gap-5 text-black">

            <!-- nom -->
            <div>
              <label class="block mb-2 text-sm font-medium" for="">nom</label>
              <input type="text" formControlName="nom" name="nom" class="block w-full p-2.5 text-sm bg-white border-gray-300 border rounded-lg focus:ring-blue-500 focus:border-blue-500"/>
            </div>

            <!-- prenom -->
            <div>
              <label class="block mb-2 text-sm font-medium" for="">description</label>
              <textarea formControlName="description" name="description" class="block w-full p-2.5 text-sm bg-white border-gray-300 border rounded-lg focus:ring-blue-500 focus:border-blue-500" ></textarea>
            </div>

            <!-- Permissions Section -->
            <div class="mt-6 col-span-2">
              <label class="block mb-3 text-sm font-medium">Permissions:</label>
              <div class="grid grid-cols-2 gap-3 max-h-60 overflow-y-auto p-2 border border-gray-200 rounded-lg">
                @if (permissions) {
                  @for (permission of permissions; track $index) {

                    <div class="flex items-start">
                      <input
                        #checkboxInput
                        type="checkbox"
                        [id]="'perm_' + permission.id"
                        [checked]="isPermissionSelected(permission.id)"
                        (change)="onPermissionChange(permission.id, checkboxInput.checked)"
                        class="mt-1 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                      >
                      <label [for]="'perm_' + permission.id" class="ml-2 text-sm cursor-pointer">
                        <span class="font-medium">{{ permission.nom }}</span>
                      </label>
                    </div>
                  }
                }
              </div>
            </div>

          </div>
          <button type="submit" class="w-full mt-5 rounded-md bg-blue-600 text-center py-3 text-white">
            modifier
          </button>
        </form>
  </p-dialog>
  <!-- end compte edit form popup -->

    <p-toast />
    <p-confirmdialog />